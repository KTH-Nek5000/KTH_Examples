# Post processing of turbulence statistics files for 3D periodic pipe flow.

This example presents use of post processing routines for turbulence statistics tool.
  - In order to produce the data see [pipe_STAT](https://github.com/KTH-Nek5000/KTH_Examples/tree/master/pipe_STAT)
  - In order to generate the mesh via gmsh see [PipeMesh](https://github.com/KTH-Nek5000/PipeMesh)

## Tool list:
* [frame](https://kth-nek5000.github.io/KTH_Framework/group__frame.html) - backbone of the toolbox
* [mntr](https://kth-nek5000.github.io/KTH_Framework/group__monitor.html) - monitoring tool: logging and timing
* [rprm](https://kth-nek5000.github.io/KTH_Framework/group__runparam.html) - runtime parameters
* [io_tool](https://kth-nek5000.github.io/KTH_Framework/group__io__tools.html) - simple I/O tools
* [pstat2d](https://kth-nek5000.github.io/KTH_Framework/group__pstat2d.html) - post processing for turbulence statistics tool


## General:
  - Nek5000 V19
  - Python 3

## Folders:
   - `pp_python`: contains the script required to generate the interpolating mesh(`pipeInterpMesh.py`) and to elaborate statistics(`main_pipePP.py`), the input paramaters list(`input.txt`), the subfolders `MODULES`, where the modules used to evaluate statistcs are located, and `OUTPUT` with the final statistics. In `nom_fields.txt` the nomenclature of the interpolating fields saved by Nek is explained.
   - `pp_nek`: scripts required to run nek in post-processing mode

## Instructions:
   1. After run your simulation, please move _sts\*_ files and _c2DturbPipe0.f00001_ into `pp_nek/DATA`.
   2. `./pp_python`: set the density, viscosity and the interpolating mesh parameters in the file `input.txt` \[DO NOT CHANGE FILE FORMAT!\]
   3. `./pp_python`: execute the script `pipeInterpMesh.py` which generates the binary file `int_pos`. This contains the interpolating mesh points coordinates.
   4. copy `int_pos` from the folder `pp_python` to `../pp_nek/DATA`
   5. `./pp_nek/DATA`: here the main data files have to be present (_sts\*_, _c2D\*_ and _int\_pos_)
   6. `./pp_nek`: the stats framework is used here (please see [KTH-Nek5000](https://github.com/KTH-Nek5000)). Set properly: `SIZE`, `makefile_usr.inc`, `compile_script`, `turbPipe.usr` and `turbPipe.par` (e.g. number of sts files, _c2D\*_ file number, etc.). To post-process your case, once copied the data as previously indicated, taking care to set the proper NEK\_SOURCE\_ROOT (i.e. where your code is located) in `compile_script.` Let compile nek5000 with "./compile\_script --all".
   7. `./pp_nek`: pay attention that the 2D mesh should be present here. Please double check: `turbPipe.geo`, `turbPipe.msh`, `turbPipe.re2` and `turbPipe.ma2`. In the repository only `turbPipe.geo` is available, so generate the other files with gmsh or proper Nek5000 tools, i.e. gmsh2nek and genmap.  To run the case just execute `run.sh`, where you can set the number of processors when is running in parallel. (**Note**: the 2D mesh has to be consistent with the corresponding 3D case, _i.e._ one circular cross section of the 3D straight pipe).
   8. copy the binary file `int_fld` generated by nek to `../pp_python`. This file contains the interpolated fields.
   9. `./pp_python`: execute the script `main_pipePP.py`. It will generate the _\*.txt_ stats files and also show you the trends of the main quantities. At point 6 of `main_pipePP.py` you can uncomment what you are interested in.

